<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>Tutorial: Masked Arrays &mdash; NumPy v1.20.dev0 Manual</title>
    
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-extend.css">
    <link rel="stylesheet" href="../_static/scipy.css" type="text/css" >
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" >
    <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" >
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.20.0.dev0+64619c5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/js/copybutton.js"></script>
    <link rel="author" title="About these documents" href="../about.html" >
    <link rel="index" title="Index" href="../genindex.html" >
    <link rel="search" title="Search" href="../search.html" >
    <link rel="top" title="NumPy v1.20.dev0 Manual" href="../index.html" >
    <link rel="up" title="NumPy Tutorials" href="tutorials_index.html" >
    <link rel="next" title="NumPy How Tos" href="howtos_index.html" >
    <link rel="prev" title="Tutorial: Linear algebra on n-dimensional arrays" href="tutorial-svd.html" >
<style>
  .main {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }
  div.top-scipy-org-logo-header {
    background-color: #fafafa;
    border-bottom: 2px solid #013243; /* Warm Black */
    margin-top: 0;
    box-shadow: none;
  }
  div.top-scipy-org-logo-header img {
    height: 100px;
    padding-left: 27px;
  }
  div.spc-navbar .nav-pills > li > a {
    background-color: #4d77cf; /* Han Blue */
  }
</style>
 

  </head>
  <body>
<div class="container">
  <div class="top-scipy-org-logo-header">
    <a href="../index.html">
      <img border=0 alt="NumPy" src="../_static/numpylogo.svg">
    </a>
  </div>
</div>


    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
        <li class="active"><a href="https://numpy.org/">NumPy.org</a></li>
        <li class="active"><a href="https://numpy.org/doc">Docs</a></li>
        
        <li class="active"><a href="../index.html">NumPy v1.20.dev0 Manual</a></li>
        

          <li class="active"><a href="tutorials_index.html" accesskey="U">NumPy Tutorials</a></li> 
    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="../genindex.html" title="General Index"
           accesskey="I">index</a>
      </li>
      <li class="active">
        <a href="howtos_index.html" title="NumPy How Tos"
           accesskey="N">next</a>
      </li>
      <li class="active">
        <a href="tutorial-svd.html" title="Tutorial: Linear algebra on n-dimensional arrays"
           accesskey="P">previous</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="tutorial-svd.html"
                        title="previous chapter">Tutorial: Linear algebra on n-dimensional arrays</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="howtos_index.html"
                        title="next chapter">NumPy How Tos</a></p>
<div id="searchbox" style="display: none" role="search">
  <h4>Quick search</h4>
    <div>
    <form class="search" action="../search.html" method="get">
      <input type="text" style="width: inherit;" name="q" />
      <input type="submit" value="search" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body">
            
  <div class="section" id="tutorial-masked-arrays">
<h1>Tutorial: Masked Arrays<a class="headerlink" href="#tutorial-masked-arrays" title="Permalink to this headline">¶</a></h1>
<p><strong>Prerequisites</strong></p>
<p>Before reading this tutorial, you should know a bit of Python. If you
would like to refresh your memory, take a look at the
<a class="reference external" href="https://docs.python.org/dev/tutorial/index.html" title="(in Python v3.10)"><span class="xref std std-doc">Python tutorial</span></a>.</p>
<p>If you want to be able to run the examples in this tutorial, you should also
have <a class="reference external" href="https://matplotlib.org/">matplotlib</a> installed on your computer.</p>
<p><strong>Learner profile</strong></p>
<p>This tutorial is for people who have a basic understanding of NumPy and want to
understand how masked arrays and the <a class="reference internal" href="../reference/maskedarray.generic.html#module-numpy.ma" title="numpy.ma"><code class="xref py py-mod docutils literal notranslate"><span class="pre">numpy.ma</span></code></a> module can be used in
practice.</p>
<p><strong>Learning Objectives</strong></p>
<p>After this tutorial, you should be able to:</p>
<ul class="simple">
<li><p>Understand what are masked arrays and how they can be created</p></li>
<li><p>Understand how to access and modify data for masked arrays</p></li>
<li><p>Decide when the use of masked arrays is appropriate in some of your
applications</p></li>
</ul>
<p><strong>What are masked arrays?</strong></p>
<p>Consider the following problem. You have a dataset with missing or invalid
entries. If you’re doing any kind of processing on this data, and want to
<em class="xref py py-obj">skip</em> or flag these unwanted entries without just deleting them, you may have
to use conditionals or filter your data somehow. The <a class="reference internal" href="../reference/maskedarray.generic.html#module-numpy.ma" title="numpy.ma"><code class="xref py py-mod docutils literal notranslate"><span class="pre">numpy.ma</span></code></a> module
provides some of the same funcionality of
<a class="reference internal" href="../reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray"><code class="xref py py-class docutils literal notranslate"><span class="pre">NumPy</span> <span class="pre">ndarrays</span></code></a> with added structure to ensure
invalid entries are not used in computation.</p>
<p>From the <a class="reference internal" href="../reference/maskedarray.generic.html#module-numpy.ma" title="numpy.ma"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Reference</span> <span class="pre">Guide</span></code></a>:</p>
<blockquote>
<div><p>A masked array is the combination of a standard <a class="reference internal" href="../reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> and
a <strong>mask</strong>. A mask is either <code class="docutils literal notranslate"><span class="pre">nomask</span></code>, indicating that no value of the
associated array is invalid, or an array of booleans that determines for
each element of the associated array whether the value is valid or not.
When an element of the mask is <code class="docutils literal notranslate"><span class="pre">False</span></code>, the corresponding element of the
associated array is valid and is said to be unmasked. When an element of
the mask is <code class="docutils literal notranslate"><span class="pre">True</span></code>, the corresponding element of the associated array is
said to be masked (invalid).</p>
</div></blockquote>
<p>We can think of a <a class="reference internal" href="../reference/maskedarray.baseclass.html#numpy.ma.MaskedArray" title="numpy.ma.MaskedArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">MaskedArray</span></code></a> as a
combination of:</p>
<ul class="simple">
<li><p>Data, as a regular <a class="reference internal" href="../reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> of any shape or datatype;</p></li>
<li><p>A boolean mask with the same shape as the data;</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">fill_value</span></code>, a value that may be used to replace the invalid entries
in order to return a standard <a class="reference internal" href="../reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>.</p></li>
</ul>
<p><strong>When can they be useful?</strong></p>
<p>There are a few situations where masked arrays can be more useful than just
eliminating the invalid entries of an array:</p>
<ul class="simple">
<li><p>When you want to preserve the values you masked for later processing, without
copying the array;</p></li>
<li><p>When you have to handle many arrays, each with their own mask. If the mask is
part of the array, you avoid bugs and the code is possibly more compact;</p></li>
<li><p>When you have different flags for missing or invalid values, and wish to
preserve these flags without replacing them in the original dataset, but
exclude them from computations;</p></li>
<li><p>If you can’t avoid or eliminate missing values, but don’t want to deal with
<a class="reference internal" href="../reference/constants.html#numpy.nan" title="numpy.nan"><code class="xref py py-class docutils literal notranslate"><span class="pre">NaN</span></code></a> (Not A Number) values in your operations.</p></li>
</ul>
<p>Masked arrays are also a good idea since the <a class="reference internal" href="../reference/maskedarray.generic.html#module-numpy.ma" title="numpy.ma"><code class="xref py py-mod docutils literal notranslate"><span class="pre">numpy.ma</span></code></a> module also
comes with a specific implementation of most <a class="reference internal" href="../glossary.html#term-ufunc"><span class="xref std std-term">NumPy universal functions
(ufuncs)</span></a>, which means that you can still apply fast vectorized
functions and operations on masked data. The output is then a masked array.
We’ll see some examples of how this works in practice below.</p>
<p><strong>Using masked arrays to see COVID-19 data</strong></p>
<p>From <a class="reference external" href="https://www.kaggle.com/atilamadai/covid19">Kaggle</a> it is possible to
download a dataset with initial data about the COVID-19 outbreak in the
beginning of 2020. We are going to look at a small subset of this data,
contained in the file <code class="docutils literal notranslate"><span class="pre">who_covid_19_sit_rep_time_series.csv</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="gp">In [2]: </span><span class="kn">import</span> <span class="nn">os</span>

<span class="go"># The os.getcwd() function returns the current folder; you can change</span>
<span class="go"># the filepath variable to point to the folder where you saved the .csv file</span>
<span class="gp">In [3]: </span><span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

<span class="gp">In [4]: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;who_covid_19_sit_rep_time_series.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The data file contains data of different types and is organized as follows:</p>
<ul class="simple">
<li><p>The first row is a header line that (mostly) describes the data in each column
that follow in the rows below, and beginning in the fourth column, the header
is the date of the observation.</p></li>
<li><p>The second through seventh row contain summary data that is of a different
type than that which we are going to examine, so we will need to exclude that
from the data with which we will work.</p></li>
<li><p>The numerical data we wish to work with begins at column 4, row 8, and extends
from there to the rightmost column and the lowermost row.</p></li>
</ul>
<p>Let’s explore the data inside this file for the first 14 days of records. To
gather data from the <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file, we will use the <a class="reference internal" href="../reference/generated/numpy.genfromtxt.html#numpy.genfromtxt" title="numpy.genfromtxt"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.genfromtxt</span></code></a>
function, making sure we select only the columns with actual numbers instead of
the first three columns which contain location data. We also skip the first 7
rows of this file, since they contain other data we are not interested in.
Separately, we will extract the information about dates and location for this
data.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># Note we are using skip_header and usecols to read only portions of the</span>
<span class="go"># data file into each variable.</span>
<span class="go"># Read just the dates for columns 3-7 from the first row</span>
<span class="gp">In [5]: </span><span class="n">dates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unicode_</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span>
<span class="gp">   ...: </span>                      <span class="n">max_rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span>
<span class="gp">   ...: </span>                      <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8-sig&quot;</span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="go"># Read the names of the geographic locations from the first two</span>
<span class="go"># columns, skipping the first seven rows</span>
<span class="gp">In [6]: </span><span class="n">locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unicode_</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span>
<span class="gp">   ...: </span>                          <span class="n">skip_header</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">   ...: </span>                          <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8-sig&quot;</span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="go"># Read the numeric data from just the first 14 days</span>
<span class="gp">In [7]: </span><span class="n">nbcases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span>
<span class="gp">   ...: </span>                        <span class="n">skip_header</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span>
<span class="gp">   ...: </span>                        <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8-sig&quot;</span><span class="p">)</span>
<span class="gp">   ...: </span>
</pre></div>
</div>
<p>Included in the <a class="reference internal" href="../reference/generated/numpy.genfromtxt.html#numpy.genfromtxt" title="numpy.genfromtxt"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.genfromtxt</span></code></a> function call, we have selected the
<a class="reference internal" href="../reference/generated/numpy.dtype.html#numpy.dtype" title="numpy.dtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.dtype</span></code></a> for each subset of the data (either an integer -
<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.int_</span></code> - or a string of characters - <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.unicode_</span></code>). We
have also used the <code class="docutils literal notranslate"><span class="pre">encoding</span></code> argument to select <code class="docutils literal notranslate"><span class="pre">utf-8-sig</span></code> as the encoding
for the file (read more about encoding in the <a class="reference external" href="https://docs.python.org/3/library/codecs.html#encodings-and-unicode">official Python documentation</a>). You
can read more about the <a class="reference internal" href="../reference/generated/numpy.genfromtxt.html#numpy.genfromtxt" title="numpy.genfromtxt"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.genfromtxt</span></code></a> function from
the <a class="reference internal" href="../reference/generated/numpy.genfromtxt.html#numpy.genfromtxt" title="numpy.genfromtxt"><code class="xref py py-func docutils literal notranslate"><span class="pre">Reference</span> <span class="pre">Documentation</span></code></a> or from the
<a class="reference internal" href="basics.io.genfromtxt.html"><span class="doc">Basic IO tutorial</span></a>.</p>
<p><strong>Exploring the data</strong></p>
<p>First of all, we can plot the whole set of data we have and see what it looks
like. In order to get a readable plot, we select only a few of the dates to
show in our <a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.xticks.html#matplotlib.pyplot.xticks" title="(in Matplotlib v3.3.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">x-axis</span> <span class="pre">ticks</span></code></a>. Note also that in
our plot command, we use <code class="docutils literal notranslate"><span class="pre">nbcases.T</span></code> (the transpose of the <code class="docutils literal notranslate"><span class="pre">nbcases</span></code> array)
since this means we will plot each row of the file as a separate line. We choose
to plot a dashed line (using the <code class="docutils literal notranslate"><span class="pre">'--'</span></code> line style). See the
<a class="reference external" href="https://matplotlib.org/">matplotlib</a> documentation for more info on this.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="gp">In [9]: </span><span class="n">selected_dates</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>

<span class="gp">In [10]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">nbcases</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">);</span>

<span class="gp">In [11]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">selected_dates</span><span class="p">,</span> <span class="n">dates</span><span class="p">[</span><span class="n">selected_dates</span><span class="p">]);</span>

<span class="gp">In [12]: </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;COVID-19 cumulative cases from Jan 21 to Feb 3 2020&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/plot_covid_1.png" src="../_images/plot_covid_1.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are executing the commands above in the IPython shell, it might be
necessary to use the command <code class="docutils literal notranslate"><span class="pre">plt.show()</span></code> to show the image window. Note
also that we use a semicolon at the end of a line to suppress its output, but
this is optional.</p>
</div>
<p>The graph has a strange shape from January 24th to February 1st. It would be
interesing to know where this data comes from. If we look at the <code class="docutils literal notranslate"><span class="pre">locations</span></code>
array we extracted from the <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file, we can see that we have two columns,
where the first would contain regions and the second would contain the name of
the country. However, only the first few rows contain data for the the first
column (province names in China). Following that, we only have country names. So
it would make sense to group all the data from China into a single row. For
this, we’ll select from the <code class="docutils literal notranslate"><span class="pre">nbcases</span></code> array only the rows for which the
second entry of the <code class="docutils literal notranslate"><span class="pre">locations</span></code> array corresponds to China. Next, we’ll use
the <a class="reference internal" href="../reference/generated/numpy.sum.html#numpy.sum" title="numpy.sum"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.sum</span></code></a> function to sum all the selected rows (<code class="docutils literal notranslate"><span class="pre">axis=0</span></code>):</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="n">china_total</span> <span class="o">=</span> <span class="n">nbcases</span><span class="p">[</span><span class="n">locations</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;China&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="gp">In [14]: </span><span class="n">china_total</span>
<span class="gh">Out[14]: </span><span class="go"></span>
<span class="go">array([  247,   288,   556,   817,   -22,   -22,   -15,   -10,    -9,</span>
<span class="go">          -7,    -4, 11820, 14410, 17237])</span>
</pre></div>
</div>
<p>Something’s wrong with this data - we are not supposed to have negative values
in a cumulative data set. What’s going on?</p>
<p><strong>Missing data</strong></p>
<p>Looking at the data, here’s what we find: there is a period with
<strong>missing data</strong>:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [15]: </span><span class="n">nbcases</span>
<span class="gh">Out[15]: </span><span class="go"></span>
<span class="go">array([[  258,   270,   375, ...,  7153,  9074, 11177],</span>
<span class="go">       [   14,    17,    26, ...,   520,   604,   683],</span>
<span class="go">       [   -1,     1,     1, ...,   422,   493,   566],</span>
<span class="go">       ...,</span>
<span class="go">       [   -1,    -1,    -1, ...,    -1,    -1,    -1],</span>
<span class="go">       [   -1,    -1,    -1, ...,    -1,    -1,    -1],</span>
<span class="go">       [   -1,    -1,    -1, ...,    -1,    -1,    -1]])</span>
</pre></div>
</div>
<p>All the <code class="docutils literal notranslate"><span class="pre">-1</span></code> values we are seeing come from <a class="reference internal" href="../reference/generated/numpy.genfromtxt.html#numpy.genfromtxt" title="numpy.genfromtxt"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.genfromtxt</span></code></a>
attempting to read missing data from the original <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file. Obviously, we
don’t want to compute missing data as <code class="docutils literal notranslate"><span class="pre">-1</span></code> - we just want to skip this value
so it doesn’t interfere in our analysis. After importing the <a class="reference internal" href="../reference/maskedarray.generic.html#module-numpy.ma" title="numpy.ma"><code class="xref py py-mod docutils literal notranslate"><span class="pre">numpy.ma</span></code></a>
module, we’ll create a new array, this time masking the invalid values:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [16]: </span><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ma</span>

<span class="gp">In [17]: </span><span class="n">nbcases_ma</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_values</span><span class="p">(</span><span class="n">nbcases</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>If we look at the <code class="docutils literal notranslate"><span class="pre">nbcases_ma</span></code> masked array, this is what we have:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="n">nbcases_ma</span>
<span class="gh">Out[18]: </span><span class="go"></span>
<span class="go">masked_array(</span>
<span class="go">  data=[[258, 270, 375, ..., 7153, 9074, 11177],</span>
<span class="go">        [14, 17, 26, ..., 520, 604, 683],</span>
<span class="go">        [--, 1, 1, ..., 422, 493, 566],</span>
<span class="go">        ...,</span>
<span class="go">        [--, --, --, ..., --, --, --],</span>
<span class="go">        [--, --, --, ..., --, --, --],</span>
<span class="go">        [--, --, --, ..., --, --, --]],</span>
<span class="go">  mask=[[False, False, False, ..., False, False, False],</span>
<span class="go">        [False, False, False, ..., False, False, False],</span>
<span class="go">        [ True, False, False, ..., False, False, False],</span>
<span class="go">        ...,</span>
<span class="go">        [ True,  True,  True, ...,  True,  True,  True],</span>
<span class="go">        [ True,  True,  True, ...,  True,  True,  True],</span>
<span class="go">        [ True,  True,  True, ...,  True,  True,  True]],</span>
<span class="go">  fill_value=-1)</span>
</pre></div>
</div>
<p>We can see that this is a different kind of array. As mentioned in the
introduction, it has three attributes (<code class="docutils literal notranslate"><span class="pre">data</span></code>, <code class="docutils literal notranslate"><span class="pre">mask</span></code> and <code class="docutils literal notranslate"><span class="pre">fill_value</span></code>).
Keep in mind that the <code class="docutils literal notranslate"><span class="pre">mask</span></code> attribute has a <code class="docutils literal notranslate"><span class="pre">True</span></code> value for elements
corresponding to <strong>invalid</strong> data (represented by two dashes in the <code class="docutils literal notranslate"><span class="pre">data</span></code>
attribute).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Adding <code class="docutils literal notranslate"><span class="pre">-1</span></code> to missing data is not a problem with <a class="reference internal" href="../reference/generated/numpy.genfromtxt.html#numpy.genfromtxt" title="numpy.genfromtxt"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.genfromtxt</span></code></a>;
in this particular case, substituting the missing value with <code class="docutils literal notranslate"><span class="pre">0</span></code> might have
been fine, but we’ll see later that this is far from a general solution.
Also, it is possible to call the <a class="reference internal" href="../reference/generated/numpy.genfromtxt.html#numpy.genfromtxt" title="numpy.genfromtxt"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.genfromtxt</span></code></a> function using the
<code class="docutils literal notranslate"><span class="pre">usemask</span></code> parameter. If <code class="docutils literal notranslate"><span class="pre">usemask=True</span></code>, <a class="reference internal" href="../reference/generated/numpy.genfromtxt.html#numpy.genfromtxt" title="numpy.genfromtxt"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.genfromtxt</span></code></a>
automatically returns a masked array.</p>
</div>
<p>Let’s try and see what the data looks like excluding the first row
(data from the Hubei province in China) so we can look at the missing data more
closely:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">nbcases_ma</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">);</span>

<span class="gp">In [20]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">selected_dates</span><span class="p">,</span> <span class="n">dates</span><span class="p">[</span><span class="n">selected_dates</span><span class="p">]);</span>

<span class="gp">In [21]: </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;COVID-19 cumulative cases from Jan 21 to Feb 3 2020&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/plot_covid_2.png" src="../_images/plot_covid_2.png" />
<p>Now that our data has been masked, let’s try summing up all the cases in China:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [22]: </span><span class="n">china_masked</span> <span class="o">=</span> <span class="n">nbcases_ma</span><span class="p">[</span><span class="n">locations</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;China&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="gp">In [23]: </span><span class="n">china_masked</span>
<span class="gh">Out[23]: </span><span class="go"></span>
<span class="go">masked_array(data=[278, 309, 574, 835, 10, 10, 17, 22, 23, 25, 28, 11821,</span>
<span class="go">                   14411, 17238],</span>
<span class="go">             mask=[False, False, False, False, False, False, False, False,</span>
<span class="go">                   False, False, False, False, False, False],</span>
<span class="go">       fill_value=999999)</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">china_masked</span></code> is a masked array, so it has a different data
structure than a regular NumPy array. Now, we can access its data directly by
using the <code class="docutils literal notranslate"><span class="pre">.data</span></code> attribute:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [24]: </span><span class="n">china_total</span> <span class="o">=</span> <span class="n">china_masked</span><span class="o">.</span><span class="n">data</span>

<span class="gp">In [25]: </span><span class="n">china_total</span>
<span class="gh">Out[25]: </span><span class="go"></span>
<span class="go">array([  278,   309,   574,   835,    10,    10,    17,    22,    23,</span>
<span class="go">          25,    28, 11821, 14411, 17238])</span>
</pre></div>
</div>
<p>That is better: no more negative values. However, we can still see that for some
days, the cumulative number of cases seems to go down (from 835 to 10, for
example), which does not agree with the definition of “cumulative data”. If we
look more closely at the data, we can see that in the period where there was
missing data in mainland China, there was valid data for Hong Kong, Taiwan,
Macau and “Unspecified” regions of China. Maybe we can remove those from the
total sum of cases in China, to get a better understanding of the data.</p>
<p>First, we’ll identify the indices of locations in mainland China:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [26]: </span><span class="n">china_mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">locations</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;China&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
<span class="gp">   ....: </span>              <span class="p">(</span><span class="n">locations</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Hong Kong&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
<span class="gp">   ....: </span>              <span class="p">(</span><span class="n">locations</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Taiwan&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
<span class="gp">   ....: </span>              <span class="p">(</span><span class="n">locations</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Macau&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
<span class="gp">   ....: </span>              <span class="p">(</span><span class="n">locations</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Unspecified*&#39;</span><span class="p">))</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>Now, <code class="docutils literal notranslate"><span class="pre">china_mask</span></code> is an array of boolean values (<code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>); we
can check that the indices are what we wanted with the <a class="reference internal" href="../reference/generated/numpy.ma.nonzero.html#numpy.ma.nonzero" title="numpy.ma.nonzero"><code class="xref py py-func docutils literal notranslate"><span class="pre">ma.nonzero</span></code></a> method
for masked arrays:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [27]: </span><span class="n">china_mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
<span class="gh">Out[27]: </span><span class="go"></span>
<span class="go">(array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,</span>
<span class="go">        17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 31, 33]),)</span>
</pre></div>
</div>
<p>Now we can correctly sum entries for mainland China:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [28]: </span><span class="n">china_total</span> <span class="o">=</span> <span class="n">nbcases_ma</span><span class="p">[</span><span class="n">china_mask</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="gp">In [29]: </span><span class="n">china_total</span>
<span class="gh">Out[29]: </span><span class="go"></span>
<span class="go">masked_array(data=[278, 308, 440, 446, --, --, --, --, --, --, --, 11791,</span>
<span class="go">                   14380, 17205],</span>
<span class="go">             mask=[False, False, False, False,  True,  True,  True,  True,</span>
<span class="go">                    True,  True,  True, False, False, False],</span>
<span class="go">       fill_value=999999)</span>
</pre></div>
</div>
<p>We can replace the data with this information and plot a new graph, focusing on
Mainland China:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [30]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">china_total</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">);</span>

<span class="gp">In [31]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">selected_dates</span><span class="p">,</span> <span class="n">dates</span><span class="p">[</span><span class="n">selected_dates</span><span class="p">]);</span>

<span class="gp">In [32]: </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;COVID-19 cumulative cases from Jan 21 to Feb 3 2020 - Mainland China&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/plot_covid_3.png" src="../_images/plot_covid_3.png" />
<p>It’s clear that masked arrays are the right solution here. We cannot represent
the missing data without mischaracterizing the evolution of the curve.</p>
<p><strong>Fitting Data</strong></p>
<p>One possibility we can think of is to interpolate the missing data to estimate
the number of cases in late January. Observe that we can select the masked
elements using the <code class="docutils literal notranslate"><span class="pre">.mask</span></code> attribute:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [33]: </span><span class="n">china_total</span><span class="o">.</span><span class="n">mask</span>
<span class="gh">Out[33]: </span><span class="go"></span>
<span class="go">array([False, False, False, False,  True,  True,  True,  True,  True,</span>
<span class="go">        True,  True, False, False, False])</span>

<span class="gp">In [34]: </span><span class="n">invalid</span> <span class="o">=</span> <span class="n">china_total</span><span class="p">[</span><span class="n">china_total</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span>

<span class="gp">In [35]: </span><span class="n">invalid</span>
<span class="gh">Out[35]: </span><span class="go"></span>
<span class="go">masked_array(data=[--, --, --, --, --, --, --],</span>
<span class="go">             mask=[ True,  True,  True,  True,  True,  True,  True],</span>
<span class="go">       fill_value=999999,</span>
<span class="go">            dtype=int64)</span>
</pre></div>
</div>
<p>We can also access the valid entries by using the logical negation for this
mask:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [36]: </span><span class="n">valid</span> <span class="o">=</span> <span class="n">china_total</span><span class="p">[</span><span class="o">~</span><span class="n">china_total</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span>

<span class="gp">In [37]: </span><span class="n">valid</span>
<span class="gh">Out[37]: </span><span class="go"></span>
<span class="go">masked_array(data=[278, 308, 440, 446, 11791, 14380, 17205],</span>
<span class="go">             mask=[False, False, False, False, False, False, False],</span>
<span class="go">       fill_value=999999)</span>
</pre></div>
</div>
<p>Now, if we want to create a very simple approximation for this data, we should
take into account the valid entries around the invalid ones. So first let’s
select the dates for which the data is valid. Note that we can use the mask
from the <code class="docutils literal notranslate"><span class="pre">china_total</span></code> masked array to index the dates array:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [38]: </span><span class="n">dates</span><span class="p">[</span><span class="o">~</span><span class="n">china_total</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span>
<span class="gh">Out[38]: </span><span class="go"></span>
<span class="go">array([&#39;1/21/20&#39;, &#39;1/22/20&#39;, &#39;1/23/20&#39;, &#39;1/24/20&#39;, &#39;2/1/20&#39;, &#39;2/2/20&#39;,</span>
<span class="go">       &#39;2/3/20&#39;], dtype=&#39;&lt;U7&#39;)</span>
</pre></div>
</div>
<p>Finally, we can use the <a class="reference internal" href="../reference/generated/numpy.polyfit.html#numpy.polyfit" title="numpy.polyfit"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.polyfit</span></code></a> and <a class="reference internal" href="../reference/generated/numpy.polyval.html#numpy.polyval" title="numpy.polyval"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.polyval</span></code></a>
functions to create a cubic polynomial that fits the data as best as possible:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [39]: </span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">china_total</span><span class="p">))</span>

<span class="gp">In [40]: </span><span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">~</span><span class="n">china_total</span><span class="o">.</span><span class="n">mask</span><span class="p">],</span> <span class="n">valid</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="gp">In [41]: </span><span class="n">cubic_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

<span class="gp">In [42]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">china_total</span><span class="p">);</span>

<span class="gp">In [43]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">cubic_fit</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/plot_covid_4.png" src="../_images/plot_covid_4.png" />
<p>This plot is not so readable since the lines seem to be over each other, so
let’s summarize in a more elaborate plot. We’ll plot the real data when
available, and show the cubic fit for unavailable data, using this fit to
compute an estimate to the observed number of cases on January 28th 2020, 7 days
after the beginning of the records:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [44]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">china_total</span><span class="p">);</span>

<span class="gp">In [45]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">china_total</span><span class="o">.</span><span class="n">mask</span><span class="p">],</span> <span class="n">cubic_fit</span><span class="p">[</span><span class="n">china_total</span><span class="o">.</span><span class="n">mask</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">);</span>

<span class="gp">In [46]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="s1">&#39;r*&#39;</span><span class="p">);</span>

<span class="gp">In [47]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span> <span class="n">dates</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">]]);</span>

<span class="gp">In [48]: </span><span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">17500</span><span class="p">]);</span>

<span class="gp">In [49]: </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Mainland China&#39;</span><span class="p">,</span> <span class="s1">&#39;Cubic estimate&#39;</span><span class="p">,</span> <span class="s1">&#39;7 days after start&#39;</span><span class="p">]);</span>

<span class="gp">In [50]: </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;COVID-19 cumulative cases from Jan 21 to Feb 3 2020 - Mainland China</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="gp">   ....: </span>          <span class="s2">&quot;Cubic estimate for 7 days after start&quot;</span><span class="p">);</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<img alt="../_images/plot_covid_5.png" src="../_images/plot_covid_5.png" />
<p><strong>More reading</strong></p>
<p>Topics not covered in this tutorial can be found in the documentation:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../reference/generated/numpy.ma.harden_mask.html#numpy.ma.harden_mask" title="numpy.ma.harden_mask"><code class="xref py py-func docutils literal notranslate"><span class="pre">Hardmasks</span></code></a> vs. <a class="reference internal" href="../reference/generated/numpy.ma.soften_mask.html#numpy.ma.soften_mask" title="numpy.ma.soften_mask"><code class="xref py py-func docutils literal notranslate"><span class="pre">softmasks</span></code></a></p></li>
<li><p><a class="reference internal" href="../reference/maskedarray.generic.html#maskedarray-generic"><span class="std std-ref">The numpy.ma module</span></a></p></li>
</ul>
</div>


          </div>
        </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright 2008-2020, The SciPy community.
      </li>
      <li>
      Last updated on Aug 19, 2020.
      </li>
      <li>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 2.4.4.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>